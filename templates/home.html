{% extends 'base.html' %}
{% block content %}

{# Hero Section con búsqueda integrada #}
<div class="hero-section text-center fade-in">
  <h1 class="mb-3">
    <i class="fas fa-calendar-alt"></i> Descubre Eventos Increíbles
  </h1>
  <p class="lead mb-4">Encuentra, crea y comparte experiencias únicas cerca de ti</p>
  
  {# Búsqueda integrada en hero #}
  <div class="row justify-content-center mb-4">
    <div class="col-lg-8">
      <form method="get" action="/eventos/" class="search-form-hero">
        <div class="input-group input-group-lg shadow-lg">
          <span class="input-group-text bg-white border-0">
            <i class="fas fa-search text-primary"></i>
          </span>
          <input type="text" name="q" class="form-control border-0" placeholder="Buscar eventos, lugares, categorías..." style="padding:1rem;">
          <input type="text" name="city" class="form-control border-0 border-start" placeholder="Ciudad" style="padding:1rem; max-width:200px;">
          <button class="btn btn-accent px-4" type="submit">
            <i class="fas fa-search"></i> Buscar
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="d-flex gap-3 justify-content-center flex-wrap">
    <a href="/eventos/" class="btn btn-light btn-lg">
      <i class="fas fa-compass"></i> Explorar Eventos
    </a>
    {% if user.is_authenticated %}
      <a href="/eventos/crear/" class="btn btn-accent btn-lg">
        <i class="fas fa-plus-circle"></i> Crear Evento
      </a>
    {% else %}
      <a href="/accounts/signup/" class="btn btn-accent btn-lg">
        <i class="fas fa-user-plus"></i> Únete Ahora
      </a>
    {% endif %}
  </div>
  
  {% if total_events %}
  <div class="mt-4">
    <span class="badge badge-status" style="font-size:1.1rem;">
      <i class="fas fa-fire"></i> {{ total_events }} eventos activos
    </span>
  </div>
  {% endif %}
</div>

{# Featured Events #}
{% if featured %}
<section class="mb-5 fade-in">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="section-title mb-0">
        <i class="fas fa-star text-warning"></i> Eventos Destacados
      </h2>
      <div class="divider"></div>
    </div>
    <a href="/eventos/?order=featured" class="btn btn-sm btn-outline-primary">
      Ver todos <i class="fas fa-arrow-right"></i>
    </a>
  </div>
  
  <div class="featured-grid">
    {% for e in featured %}
    <div class="card event-card">
      <div class="event-card-image">
        {% if e.cover_media %}
          <img src="{% url 'events:media_blob' e.cover_media.id %}" class="card-img-top" alt="{{ e.title }}" loading="lazy">
        {% elif e.media.count > 0 %}
          {% with first_media=e.media.all.0 %}
            <img src="{% url 'events:media_blob' first_media.id %}" class="card-img-top" alt="{{ e.title }}" loading="lazy">
          {% endwith %}
        {% else %}
          <div class="card-img-top event-card-placeholder">
            <i class="fas fa-calendar-day fa-4x"></i>
          </div>
        {% endif %}
        <div class="event-card-badges">
          <span class="badge badge-featured">
            <i class="fas fa-star"></i> Destacado
          </span>
        </div>
      </div>
      
      <div class="card-body">
        <div class="mb-2">
          <span class="badge bg-secondary">
            <i class="fas fa-tag"></i> {{ e.category.name }}
          </span>
          {% if e.is_free %}
            <span class="badge bg-success">
              <i class="fas fa-gift"></i> Gratis
            </span>
          {% endif %}
        </div>
        
        <h5 class="card-title">
          <a href="{{ e.get_absolute_url }}">{{ e.title }}</a>
        </h5>
        
        <p class="card-text text-muted small">{{ e.description|truncatechars:100 }}</p>
        
        <div class="event-meta">
          <span class="event-meta-item">
            <i class="fas fa-calendar"></i> {{ e.start_datetime|date:"d M, Y" }}
          </span>
          <span class="event-meta-item">
            <i class="fas fa-map-marker-alt"></i> {{ e.city }}
          </span>
          {% if not e.is_free %}
            <span class="event-meta-item text-primary fw-bold">
              <i class="fas fa-ticket-alt"></i> ${{ e.price }}
            </span>
          {% endif %}
        </div>
        
        <a href="{{ e.get_absolute_url }}" class="btn btn-outline-primary btn-sm w-100 mt-3">
          <i class="fas fa-info-circle"></i> Ver Detalles
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{# Quick Stats #}
{% if categories %}
<section class="mb-5 fade-in">
  <h2 class="section-title text-center">
    <i class="fas fa-chart-line"></i> Explora por Categoría
  </h2>
  <div class="divider mx-auto"></div>
  
  <div class="row g-3">
    {% for cat in categories %}
    <div class="col-6 col-md-4 col-lg-3">
      <a href="/eventos/?category={{ cat.slug }}" class="text-decoration-none">
        <div class="card category-card text-center h-100">
          <div class="card-body">
            <div class="category-icon mb-2">
              {% if 'Música' in cat.name or 'Musica' in cat.name %}<i class="fas fa-music fa-2x"></i>
              {% elif 'Deporte' in cat.name %}<i class="fas fa-football-ball fa-2x"></i>
              {% elif 'Tecnología' in cat.name or 'Tecnologia' in cat.name %}<i class="fas fa-laptop-code fa-2x"></i>
              {% elif 'Gastronomía' in cat.name or 'Gastronomia' in cat.name %}<i class="fas fa-utensils fa-2x"></i>
              {% elif 'Arte' in cat.name %}<i class="fas fa-palette fa-2x"></i>
              {% elif 'Cine' in cat.name %}<i class="fas fa-film fa-2x"></i>
              {% elif 'Teatro' in cat.name %}<i class="fas fa-theater-masks fa-2x"></i>
              {% elif 'Educación' in cat.name or 'Educacion' in cat.name %}<i class="fas fa-graduation-cap fa-2x"></i>
              {% elif 'Negocio' in cat.name %}<i class="fas fa-briefcase fa-2x"></i>
              {% elif 'Salud' in cat.name %}<i class="fas fa-heartbeat fa-2x"></i>
              {% elif 'Familia' in cat.name %}<i class="fas fa-child fa-2x"></i>
              {% elif 'Moda' in cat.name %}<i class="fas fa-tshirt fa-2x"></i>
              {% elif 'Libro' in cat.name %}<i class="fas fa-book fa-2x"></i>
              {% elif 'Juego' in cat.name %}<i class="fas fa-gamepad fa-2x"></i>
              {% elif 'Fotografía' in cat.name or 'Fotografia' in cat.name %}<i class="fas fa-camera fa-2x"></i>
              {% elif 'Viaje' in cat.name %}<i class="fas fa-plane fa-2x"></i>
              {% elif 'Naturaleza' in cat.name %}<i class="fas fa-tree fa-2x"></i>
              {% elif 'Social' in cat.name %}<i class="fas fa-users fa-2x"></i>
              {% elif 'Beneficencia' in cat.name %}<i class="fas fa-hands-helping fa-2x"></i>
              {% else %}<i class="fas fa-star fa-2x"></i>{% endif %}
            </div>
            <h6 class="card-title mb-2">{{ cat.name }}</h6>
            <span class="badge bg-primary">{{ cat.event_count }}</span>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{# Latest Events - Versión compacta #}
{% if latest %}
<section class="fade-in">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="section-title mb-0">
        <i class="fas fa-clock"></i> Últimos Eventos
      </h2>
      <div class="divider"></div>
    </div>
    <a href="/eventos/" class="btn btn-sm btn-outline-primary">
      Ver todos <i class="fas fa-arrow-right"></i>
    </a>
  </div>
  
  <div class="row g-3">
    {% for e in latest %}
    <div class="col-md-6 col-lg-4">
      <div class="card event-card-compact h-100">
        <div class="row g-0">
          <div class="col-4">
            {% if e.cover_media %}
              <img src="{% url 'events:media_blob' e.cover_media.id %}" class="img-fluid h-100" style="object-fit:cover;" alt="{{ e.title }}">
            {% elif e.media.count > 0 %}
              {% with first_media=e.media.all.0 %}
                <img src="{% url 'events:media_blob' first_media.id %}" class="img-fluid h-100" style="object-fit:cover;" alt="{{ e.title }}">
              {% endwith %}
            {% else %}
              <div class="h-100 d-flex align-items-center justify-content-center bg-light">
                <i class="fas fa-calendar fa-2x text-muted"></i>
              </div>
            {% endif %}
          </div>
          <div class="col-8">
            <div class="card-body p-3">
              <h6 class="card-title mb-2">
                <a href="{{ e.get_absolute_url }}" class="text-decoration-none">
                  {{ e.title|truncatechars:50 }}
                </a>
              </h6>
              <div class="small">
                <div class="text-muted mb-1">
                  <i class="fas fa-calendar"></i> {{ e.start_datetime|date:"d/m/Y" }}
                </div>
                <div class="text-muted">
                  <i class="fas fa-map-marker-alt"></i> {{ e.city }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="fas fa-info-circle"></i> No hay eventos recientes todavía.
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% endblock %}
